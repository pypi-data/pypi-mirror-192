# automatically generated by auxilium
{% include 'base_arg.jinja2' -%}
FROM {{ opts.base | default(aux.project.slug~"-python-deps-"~opts.version_slug, true) }} as req-installed

{% include 'apt_install_root.jinja2' -%}
{% include 'extra_script.jinja2' -%}

FROM req-installed AS intermediary
USER root:root
RUN apt-get update && apt-get install -y \
    build-essential \
    --no-install-recommends && apt-get clean && rm -rf /var/lib/apt/lists/*

USER container:container
WORKDIR /home/container

{% include 'pip_install.jinja2' -%}

RUN git init
COPY devops/pre-commit/config.yaml .pre-commit-config.yaml
RUN pre-commit install-hooks

FROM req-installed as final

USER container:container
WORKDIR /home/container

COPY --chown=container --from=intermediary /home/container/.local/bin/ .local/bin/
COPY --chown=container --from=intermediary /home/container/.local/lib/ .local/lib/
COPY --chown=container --from=intermediary /home/container/.cache/pre-commit/ .cache/pre-commit/

ENV PYTHONPATH='{{ aux.project.get("source_dir", "source") }}'
CMD ["pre-commit", "run"]
