"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_asyncView_tsx-app_views_monitors_monitorForm_tsx"],{"./app/views/asyncView.tsx":(e,t,n)=>{n.d(t,{Z:()=>s});var o=n("./app/components/asyncComponent.tsx"),i=n("./app/components/sentryDocumentTitle.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class s extends o.Z{getTitle(){return""}render(){return(0,r.tZ)(i.Z,{title:this.getTitle(),children:this.renderComponent()})}}s.displayName="AsyncView"},"./app/views/monitors/monitorForm.tsx":(e,t,n)=>{n.d(t,{Z:()=>B});var o=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),l=n("../node_modules/mobx-react-lite/es/index.js"),a=n("./app/components/forms/fieldGroup/index.tsx"),c=n("./app/components/forms/fields/numberField.tsx"),d=n("./app/components/forms/fields/selectField.tsx"),m=n("./app/components/forms/fields/sentryProjectSelectorField.tsx"),p=n("./app/components/forms/fields/textField.tsx"),u=n("./app/components/forms/form.tsx"),h=n("./app/components/forms/model.tsx"),f=n("./app/components/links/externalLink.tsx"),g=n("./app/components/panels/index.tsx"),b=n("./app/components/textCopyInput.tsx"),x=n("./app/components/timeSince.tsx"),y=n("./app/data/timezones.tsx"),Z=n("./app/locale.tsx"),k=n("./app/utils/theme.tsx"),_=n("./app/utils/withPageFilters.tsx"),v=n("./app/utils/withProjects.tsx"),j=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const w=[{value:"crontab",label:"Crontab"},{value:"interval",label:"Interval"}],C="cron_job";function q(e,t){return t.fields.toJSON().reduce(((e,t)=>{let[n,o]=t;return 0!==n.indexOf("config.")?(e[n]=o,e):(e.config||(e.config={}),"config.schedule.frequency"!==n&&"config.schedule.interval"!==n||Array.isArray(e.config.schedule)||(e.config.schedule=[null,null]),"config.schedule.frequency"===n?e.config.schedule[0]=parseInt(o,10):"config.schedule.interval"===n?e.config.schedule[1]=o:e.config[n.substr(7)]=o,e)}),{})}class F extends s.Component{constructor(){super(...arguments),(0,i.Z)(this,"form",new h.Z({transformData:q}))}formDataFromConfig(e,t){const n={};return"cron_job"===e&&(n["config.schedule_type"]=t.schedule_type,n["config.checkin_margin"]=t.checkin_margin,n["config.max_runtime"]=t.max_runtime,"interval"===t.schedule_type?(n["config.schedule.frequency"]=t.schedule[0],n["config.schedule.interval"]=t.schedule[1]):(n["config.schedule"]=t.schedule,n["config.timezone"]=t.timezone)),n}render(){const{monitor:e,submitLabel:t}=this.props,n=this.props.selection.projects[0],i=n?this.props.projects.find((e=>e.id===n+"")):null;return(0,j.BX)(u.Z,{allowUndo:!0,requireChanges:!0,apiEndpoint:this.props.apiEndpoint,apiMethod:this.props.apiMethod,model:this.form,initialData:e?{name:e.name,type:e.type??C,project:e.project.slug,...this.formDataFromConfig(e.type,e.config)}:{project:i?i.slug:null,type:C},onSubmitSuccess:this.props.onSubmitSuccess,submitLabel:t,children:[(0,j.BX)(g.s_,{children:[(0,j.tZ)(g.V9,{children:(0,Z.t)("Details")}),(0,j.BX)(g.N,{children:[e&&(0,j.tZ)(a.Z,{label:(0,Z.t)("ID"),children:(0,j.tZ)("div",{className:"controls",children:(0,j.tZ)(b.Z,{children:e.id})})}),(0,j.tZ)(m.Z,{name:"project",label:(0,Z.t)("Project"),projects:this.props.projects.filter((e=>e.isMember)),valueIsSlug:!0,help:(0,Z.t)("Select the project which contains the recurring job you'd like to monitor."),required:!0}),(0,j.tZ)(p.Z,{name:"name",placeholder:(0,Z.t)("My Cron Job"),label:(0,Z.t)("Name your cron monitor"),required:!0})]})]}),(0,j.BX)(g.s_,{children:[(0,j.tZ)(g.V9,{children:(0,Z.t)("Config")}),(0,j.BX)(g.N,{children:[void 0!==e&&e.nextCheckIn&&(0,j.tZ)(g.aU,{type:"info",children:(0,Z._N)("Any changes you make to the execution schedule will only be applied after the next expected check-in [nextCheckin].",{nextCheckin:(0,j.tZ)("strong",{children:(0,j.tZ)(x.Z,{date:e.nextCheckIn})})})}),(0,j.tZ)(c.Z,{name:"config.max_runtime",label:(0,Z.t)("Max Runtime"),help:(0,Z.t)("Set the number of minutes a recurring job is allowed to run before it's considered failed"),placeholder:"e.g. 30"}),(0,j.tZ)(d.Z,{name:"config.schedule_type",label:(0,Z.t)("Schedule Type"),options:w,required:!0}),(0,j.tZ)(l.Qj,{children:()=>{switch(this.form.getValue("config.schedule_type")){case"crontab":return(0,j.BX)(s.Fragment,{children:[(0,j.tZ)(p.Z,{name:"config.schedule",label:(0,Z.t)("Schedule"),placeholder:"*/5 * * * *",required:!0,help:(0,Z._N)("Any schedule changes will be applied to the next check-in. See [link:Wikipedia] for crontab syntax.",{link:(0,j.tZ)(f.Z,{href:"https://en.wikipedia.org/wiki/Cron"})}),css:(0,o.iv)({input:{fontFamily:k.ZP.text.familyMono}},"","")}),(0,j.tZ)(d.Z,{name:"config.timezone",label:(0,Z.t)("Timezone"),defaultValue:"UTC",options:y.f,help:(0,Z._N)("The timezone of your execution environment. Be sure to set this correctly, otherwise the schedule may be mismatched and check-ins will be marked as missed! Use [code:timedatectl] or similar to determine your machine's timezone.",{code:(0,j.tZ)("code",{})})}),(0,j.tZ)(c.Z,{name:"config.checkin_margin",label:(0,Z.t)("Check-in Margin"),help:(0,Z.t)("The max error margin (in minutes) before a check-in is considered missed. If you don't expect your job to start immediately at the scheduled time, expand this margin to account for delays."),placeholder:"e.g. 30"})]});case"interval":return(0,j.BX)(s.Fragment,{children:[(0,j.BX)(S,{children:[(0,j.tZ)(a.Z,{label:(0,Z.t)("Frequency"),help:(0,Z.t)("The amount of time between each job execution. Example, every 5 hours."),stacked:!0,required:!0}),(0,j.tZ)(T,{name:"config.schedule.frequency",label:(0,Z.t)("Frequency"),placeholder:"e.g. 1",hideLabel:!0,required:!0}),(0,j.tZ)(N,{name:"config.schedule.interval",label:(0,Z.t)("Interval"),options:(e=Number(this.form.getValue("config.schedule.frequency")??1),[{value:"minute",label:(0,Z.tn)("minute","minutes",e)},{value:"hour",label:(0,Z.tn)("hour","hours",e)},{value:"day",label:(0,Z.tn)("day","days",e)},{value:"week",label:(0,Z.tn)("week","weeks",e)},{value:"month",label:(0,Z.tn)("month","months",e)},{value:"year",label:(0,Z.tn)("year","years",e)}]),hideLabel:!0,required:!0})]}),(0,j.tZ)(c.Z,{name:"config.checkin_margin",label:(0,Z.t)("Check-in Margin"),help:(0,Z.t)("The max error margin (in minutes) before a check-in is considered missed. If you don't expect your job to start immediately at the scheduled time, expand this margin to account for delays."),placeholder:"e.g. 30"})]});default:return null}var e}})]})]})]})}}F.displayName="MonitorForm";const S=(0,r.Z)("div",{target:"eopbnxk2"})("display:grid;grid-template-columns:50% 1fr 1fr;align-items:center;border-bottom:1px solid ",(e=>e.theme.innerBorder),";"),T=(0,r.Z)(c.Z,{target:"eopbnxk1"})({name:"vemtxi",styles:"padding:0;border-bottom:none"}),N=(0,r.Z)(d.Z,{target:"eopbnxk0"})({name:"1408f10",styles:"padding-left:0"}),B=(0,_.Z)((0,v.Z)(F))}}]);
//# sourceMappingURL=../sourcemaps/app_views_asyncView_tsx-app_views_monitors_monitorForm_tsx.955d99300e74d0830f490e5a4c618d30.js.map