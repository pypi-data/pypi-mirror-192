"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_index_tsx"],{"./app/utils/performance/contexts/metricsCardinality.tsx":(t,e,n)=>{n.d(e,{BT:()=>b,e0:()=>C}),n("../node_modules/core-js/modules/es.array.includes.js");var r=n("../node_modules/react/index.js"),a=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),o=n("./app/utils/dates.tsx"),i=n("./app/utils/discover/eventView.tsx"),s=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),c=n("../node_modules/lodash/omit.js"),l=n.n(c),u=n("./app/utils/discover/genericDiscoverQuery.tsx"),d=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(t){let{eventView:e,location:n}=t;return l()(e.getEventsAPIPayload(n),["field","sort","per_page","query"])}function p(t){let{children:e,...n}=t;return(0,d.tZ)(u.ZP,{route:"metrics-compatibility-sums",getRequestPayload:m,...n,children:t=>{let{tableData:n,...r}=t;return e({tableData:n,...r})}})}function y(t){let{eventView:e,location:n}=t;return l()(e.getEventsAPIPayload(n),["field","sort","per_page","query"])}function f(t){let{children:e,...n}=t;return(0,d.tZ)(u.ZP,{route:"metrics-compatibility",getRequestPayload:y,...n,children:t=>{let{tableData:n,...r}=t;return e({tableData:n,...r})}})}p.displayName="MetricsCompatibilityQuery",f.displayName="MetricsCompatibilitySumsQuery";var g=n("./app/utils/performance/contexts/utils.tsx");const[h,v,x]=(0,g.n)({name:"MetricsCardinalityContext",strict:!1}),b=t=>{if(!(0,s.gp)(t.organization))return(0,d.tZ)(h,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:t.children});const e={location:t.location,orgSlug:t.organization.slug,cursor:"0:0:0"},n=i.ZP.fromLocation(t.location);n.fields=[{field:"tpm()"}];const a=function(t){const e=t.clone();return e.start||e.end||(e.statsPeriod?(0,o.YJ)(e.statsPeriod)>1&&(e.statsPeriod="1h",e.start=void 0,e.end=void 0):(e.statsPeriod="1h",e.start=void 0,e.end=void 0)),e}(n);return(0,d.tZ)(r.Fragment,{children:(0,d.tZ)(p,{eventView:a,...e,children:n=>(0,d.tZ)(f,{eventView:a,...e,children:e=>{const r=n.isLoading||e.isLoading,a=n.isLoading||e.isLoading?void 0:function(t,e,n){const r={forceTransactionsOnly:!0},a=n.features.includes("performance-mep-bannerless-ui");if(!t)return r;const o=t.compatible_projects;return e?r:t?function(t){return!_(t).metricsCount}(t)?r:function(t,e){const n=_(t);return e?n.nullCount/n.metricsCount>.01:n.nullCount>0}(t,a)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(t){const e=_(t);return e.unparamCount>=e.metricsCount}(t)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(t,e){const n=_(t);return e?n.unparamCount/n.metricsCount>.01:n.unparamCount>0}(t,a)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:o,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:r}(n.tableData&&e.tableData?{...n.tableData,...e.tableData}:null,!!n.error&&!!e.error,t.organization);return(0,d.tZ)(P,{sendOutcomeAnalytics:t.sendOutcomeAnalytics,organization:t.organization,value:{isLoading:r,outcome:a},children:t.children})}})})})};b.displayName="MetricsCardinalityProvider";const P=t=>{const e=t.value.outcome?.shouldWarnIncompatibleSDK??!1,n=t.value.outcome?.shouldNotifyUnnamedTransactions??!1,o=!t.value.outcome?.forceTransactionsOnly;return(0,r.useEffect)((()=>{!t.value.isLoading&&t.sendOutcomeAnalytics&&(0,a.Z)("performance_views.mep.metrics_outcome",{organization:t.organization,is_on_metrics:o,fallback_from_null:e,fallback_from_unparam:n})}),[t.organization,t.value.isLoading,o,n,e,t.sendOutcomeAnalytics]),(0,d.tZ)(h,{...t,children:t.children})};P.displayName="Provider",x.Consumer;const C=v;function _(t){let{sum:e}=t;try{const t=Number(e.metrics);return{metricsCount:t,unparamCount:Number(e.metrics_unparam),nullCount:Number(e.metrics_null)}}catch(t){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/contexts/metricsEnhancedSetting.tsx":(t,e,n)=>{n.d(e,{Ar:()=>f,Eg:()=>x,gp:()=>h,kP:()=>v,nP:()=>m,nl:()=>p,oR:()=>y,tm:()=>g}),n("../node_modules/core-js/modules/es.array.includes.js");var r=n("../node_modules/react/index.js"),a=n("../node_modules/react-router/es/index.js"),o=(n("./app/utils/localStorage.tsx"),n("./app/utils/queryString.tsx")),i=n("./app/utils/useOrganization.tsx"),s=n("./app/utils/performance/contexts/utils.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const[l,u,d]=(0,s.n)({name:"MetricsEnhancedSettingContext"}),m=d.Consumer;let p,y;!function(t){t.unset="unset",t.metrics="metrics",t.transactions="transactions"}(p||(p={})),function(t){t.auto="auto",t.metricsOnly="metricsOnly",t.transactionsOnly="transactionsOnly"}(y||(y={}));const f="metricSetting",g="metricSearchSetting";function h(t){const e=function(t){return t.features.includes("performance-use-metrics")}(t),n=t.features.includes("performance-transaction-name-only-search"),r=t.features.includes("dynamic-sampling")&&t.features.includes("mep-rollout-flag");return e||n||r}const v=t=>{let{children:e,location:n,_hasMEPState:s,forceTransactions:u}=t;const d=h((0,i.Z)()),m=[y.metricsOnly,y.transactionsOnly],g=n?(0,o.ro)(n.query[f]):y.metricsOnly;let v=y.metricsOnly;u&&(v=y.transactionsOnly);const x=m.find((t=>t===g))??v,b=void 0!==s,[P,C]=(0,r.useReducer)(((t,e)=>e),x),_=(0,r.useCallback)((t=>{n&&(a.browserHistory.replace({...n,query:{...n.query,[f]:t}}),C(t))}),[n,C]),[Z,j]=(0,r.useReducer)(((t,e)=>e),p.unset),O=b?s:P,S=d&&O===y.auto,w=d&&O===y.metricsOnly,T=d&&O===y.transactionsOnly,z=`${O}`;return(0,c.tZ)(l,{value:{autoSampleState:Z,metricSettingState:O,shouldQueryProvideMEPAutoParams:S,shouldQueryProvideMEPMetricParams:w,shouldQueryProvideMEPTransactionParams:T,memoizationKey:z,setMetricSettingState:_,setAutoSampleState:j},children:e})};v.displayName="MEPSettingProvider";const x=u},"./app/views/performance/index.tsx":(t,e,n)=>{n.r(e),n.d(e,{default:()=>g});var r=n("../node_modules/@tanstack/query-core/build/lib/queryClient.mjs"),a=n("../node_modules/@tanstack/react-query/build/lib/QueryClientProvider.mjs"),o=n("./app/components/acl/feature.tsx"),i=n("./app/components/alert.tsx"),s=n("./app/components/layouts/thirds.tsx"),c=n("./app/components/noProjectMessage.tsx"),l=n("./app/locale.tsx"),u=n("./app/utils/performance/contexts/metricsCardinality.tsx"),d=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),m=n("./app/utils/withOrganization.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const y=new r.S;function f(t){let{organization:e,location:n,children:r}=t;return(0,p.tZ)(o.Z,{hookName:"feature-disabled:performance-page",features:["performance-view"],organization:e,renderDisabled:function(){return(0,p.tZ)(s.T3,{withPadding:!0,children:(0,p.tZ)(i.bZ,{type:"warning",children:(0,l.t)("You don't have access to this feature")})})},children:(0,p.tZ)(c.Z,{organization:e,children:(0,p.tZ)(a.aH,{client:y,children:(0,p.tZ)(u.BT,{location:n,organization:e,children:(0,p.tZ)(d.kP,{children:r})})})})})}f.displayName="PerformanceContainer";const g=(0,m.Z)(f)}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_index_tsx.fc69bc96097b2f459af7c854e5e5c347.js.map