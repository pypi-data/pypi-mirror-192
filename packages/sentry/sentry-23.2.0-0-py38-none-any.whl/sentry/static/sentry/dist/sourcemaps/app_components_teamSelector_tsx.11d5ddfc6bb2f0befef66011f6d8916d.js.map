{"version":3,"file":"chunks/app_components_teamSelector_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/teamSelector.tsx"],"sourcesContent":["import {useRef} from 'react';\nimport {Theme} from '@emotion/react';\nimport styled from '@emotion/styled';\nimport debounce from 'lodash/debounce';\n\nimport {addTeamToProject} from 'sentry/actionCreators/projects';\nimport {Button} from 'sentry/components/button';\nimport SelectControl, {\n  ControlProps,\n  GeneralSelectValue,\n  StylesConfig,\n} from 'sentry/components/forms/controls/selectControl';\nimport IdBadge from 'sentry/components/idBadge';\nimport {Tooltip} from 'sentry/components/tooltip';\nimport {DEFAULT_DEBOUNCE_DURATION} from 'sentry/constants';\nimport {IconAdd, IconUser} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport {Organization, Project, Team} from 'sentry/types';\nimport {isActiveSuperuser} from 'sentry/utils/isActiveSuperuser';\nimport useApi from 'sentry/utils/useApi';\nimport useTeams from 'sentry/utils/useTeams';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nconst UnassignedWrapper = styled('div')`\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledIconUser = styled(IconUser)`\n  margin-left: ${space(0.25)};\n  margin-right: ${space(1)};\n  color: ${p => p.theme.gray400};\n`;\n\n// An option to be unassigned on the team dropdown\nconst unassignedOption = {\n  value: null,\n  label: (\n    <UnassignedWrapper>\n      <StyledIconUser size=\"md\" />\n      {t('Unassigned')}\n    </UnassignedWrapper>\n  ),\n  searchKey: 'unassigned',\n  actor: null,\n  disabled: false,\n};\n\n// Ensures that the svg icon is white when selected\nconst unassignedSelectStyles: StylesConfig = {\n  option: (provided, state) => {\n    // XXX: The `state.theme` is an emotion theme object, but it is not typed\n    // as the emotion theme object in react-select\n    const theme = state.theme as unknown as Theme;\n\n    return {...provided, svg: {color: state.isSelected ? theme.white : undefined}};\n  },\n};\n\nconst placeholderSelectStyles: StylesConfig = {\n  input: (provided, state) => {\n    // XXX: The `state.theme` is an emotion theme object, but it is not typed\n    // as the emotion theme object in react-select\n    const theme = state.theme as unknown as Theme;\n\n    return {\n      ...provided,\n      display: 'grid',\n      gridTemplateColumns: 'max-content 1fr',\n      alignItems: 'center',\n      gridGap: space(1),\n      ':before': {\n        backgroundColor: theme.backgroundSecondary,\n        height: 24,\n        width: 24,\n        borderRadius: 3,\n        content: '\"\"',\n        display: 'block',\n      },\n    };\n  },\n  placeholder: provided => ({\n    ...provided,\n    paddingLeft: 32,\n  }),\n};\n\ntype Props = {\n  onChange: (value: any) => any;\n  organization: Organization;\n  includeUnassigned?: boolean;\n  /**\n   * Can be used to restrict teams to a certain project and allow for new teams to be add to that project\n   */\n  project?: Project;\n  /**\n   * Function to control whether a team should be shown in the dropdown\n   */\n  teamFilter?: (team: Team) => boolean;\n  /**\n   * Controls whether the value in the dropdown is a team id or team slug\n   */\n  useId?: boolean;\n} & ControlProps;\n\ntype TeamActor = {\n  id: string;\n  name: string;\n  type: 'team';\n};\n\ntype TeamOption = GeneralSelectValue & {\n  actor: TeamActor | null;\n  searchKey: string;\n};\n\nfunction TeamSelector(props: Props) {\n  const {includeUnassigned, styles, ...extraProps} = props;\n  const {teamFilter, organization, project, multiple, value, useId, onChange} = props;\n\n  const api = useApi();\n  const {teams, fetching, onSearch} = useTeams();\n\n  // TODO(ts) This type could be improved when react-select types are better.\n  const selectRef = useRef<any>(null);\n\n  const createTeamOption = (team: Team): TeamOption => ({\n    value: useId ? team.id : team.slug,\n    label: `#${team.slug}`,\n    leadingItems: <IdBadge team={team} hideName />,\n    searchKey: team.slug,\n    actor: {\n      type: 'team',\n      id: team.id,\n      name: team.slug,\n    },\n  });\n\n  /**\n   * Closes the select menu by blurring input if possible since that seems to\n   * be the only way to close it.\n   */\n  function closeSelectMenu() {\n    if (!selectRef.current) {\n      return;\n    }\n\n    const select = selectRef.current.select;\n    const input: HTMLInputElement = select.inputRef;\n\n    if (input) {\n      // I don't think there's another way to close `react-select`\n      input.blur();\n    }\n  }\n\n  async function handleAddTeamToProject(team: Team) {\n    if (!project) {\n      closeSelectMenu();\n      return;\n    }\n\n    // Copy old value\n    const oldValue = multiple ? [...(value ?? [])] : {value};\n    // Optimistic update\n    onChange?.(createTeamOption(team));\n\n    try {\n      await addTeamToProject(api, organization.slug, project.slug, team);\n    } catch (err) {\n      // Unable to add team to project, revert select menu value\n      onChange?.(oldValue);\n    }\n\n    closeSelectMenu();\n  }\n\n  function createTeamOutsideProjectOption(team: Team): TeamOption {\n    // If the option/team is currently selected, optimistically assume it is now a part of the project\n    if (value === (useId ? team.id : team.slug)) {\n      return createTeamOption(team);\n    }\n    const canAddTeam = organization.access.includes('project:write');\n\n    return {\n      ...createTeamOption(team),\n      disabled: true,\n      label: `#${team.slug}`,\n      leadingItems: <IdBadge team={team} hideName />,\n      trailingItems: (\n        <Tooltip\n          title={\n            canAddTeam\n              ? t('Add %s to project', `#${team.slug}`)\n              : t('You do not have permission to add team to project.')\n          }\n          containerDisplayMode=\"flex\"\n        >\n          <AddToProjectButton\n            size=\"zero\"\n            borderless\n            disabled={!canAddTeam}\n            onClick={() => handleAddTeamToProject(team)}\n            icon={<IconAdd isCircled />}\n            aria-label={t('Add %s to project', `#${team.slug}`)}\n          />\n        </Tooltip>\n      ),\n      tooltip: t('%s is not a member of project', `#${team.slug}`),\n    };\n  }\n\n  function getOptions() {\n    const isSuperuser = isActiveSuperuser();\n    const filteredTeams = isSuperuser\n      ? teams\n      : teamFilter\n      ? teams.filter(teamFilter)\n      : teams;\n\n    if (project) {\n      const teamsInProjectIdSet = new Set(project.teams.map(team => team.id));\n      const teamsInProject = filteredTeams.filter(team =>\n        teamsInProjectIdSet.has(team.id)\n      );\n      const teamsNotInProject = filteredTeams.filter(\n        team => !teamsInProjectIdSet.has(team.id)\n      );\n\n      return [\n        ...teamsInProject.map(createTeamOption),\n        ...teamsNotInProject.map(createTeamOutsideProjectOption),\n        ...(includeUnassigned ? [unassignedOption] : []),\n      ];\n    }\n\n    return [\n      ...filteredTeams.map(createTeamOption),\n      ...(includeUnassigned ? [unassignedOption] : []),\n    ];\n  }\n\n  return (\n    <SelectControl\n      ref={selectRef}\n      options={getOptions()}\n      onInputChange={debounce(val => void onSearch(val), DEFAULT_DEBOUNCE_DURATION)}\n      getOptionValue={option => option.searchKey}\n      styles={{\n        ...(includeUnassigned ? unassignedSelectStyles : {}),\n        ...(multiple ? {} : placeholderSelectStyles),\n        ...(styles ?? {}),\n      }}\n      isLoading={fetching}\n      {...extraProps}\n    />\n  );\n}\n\nconst AddToProjectButton = styled(Button)`\n  flex-shrink: 0;\n`;\n\nexport {TeamSelector};\n\n// TODO(davidenwang): this is broken due to incorrect types on react-select\nexport default withOrganization(TeamSelector) as unknown as (\n  p: Omit<Props, 'organization'>\n) => JSX.Element;\n"],"names":["UnassignedWrapper","StyledIconUser","IconUser","space","p","theme","gray400","unassignedOption","value","label","size","t","searchKey","actor","disabled","unassignedSelectStyles","option","provided","state","svg","color","isSelected","white","undefined","placeholderSelectStyles","input","display","gridTemplateColumns","alignItems","gridGap","backgroundColor","backgroundSecondary","height","width","borderRadius","content","placeholder","paddingLeft","TeamSelector","props","includeUnassigned","styles","extraProps","teamFilter","organization","project","multiple","useId","onChange","api","useApi","teams","fetching","onSearch","useTeams","selectRef","useRef","createTeamOption","team","id","slug","leadingItems","hideName","type","name","closeSelectMenu","current","select","inputRef","blur","createTeamOutsideProjectOption","canAddTeam","access","includes","trailingItems","title","containerDisplayMode","AddToProjectButton","borderless","onClick","async","oldValue","addTeamToProject","err","handleAddTeamToProject","icon","isCircled","tooltip","ref","options","filteredTeams","isActiveSuperuser","filter","teamsInProjectIdSet","Set","map","teamsInProject","has","teamsNotInProject","getOptions","onInputChange","debounce","val","DEFAULT_DEBOUNCE_DURATION","getOptionValue","isLoading","Button","withOrganization"],"sourceRoot":""}