{"version":3,"file":"chunks/app_components_events_eventCustomPerformanceMetrics_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"s3BAqBO,IAAKA,EAaZ,SAASC,EAAqBC,GAC5B,OAAQA,EAAMC,WAAW,QAC3B,CAEe,SAASC,EAA8B,GAM5C,IAN4C,MACpDC,EAAK,SACLC,EAAQ,aACRC,EAAY,OACZC,EAAM,WACNC,GACM,EACN,MAAMC,EAAmBC,OAAOC,KAAKP,EAAMQ,cAAgB,CAAC,GACzDC,QAAOC,IAAQC,EAAAA,EAAAA,IAAqB,gBAAeD,OACnDD,OAAOb,GACPgB,OAEH,OAAgC,IAA5BP,EAAiBQ,OACZ,MAIP,QAACC,EAAS,YACR,QAAC,KAAc,WAAEC,EAAAA,EAAAA,GAAE,iCACnB,QAACC,EAAY,UACVX,EAAiBY,KAAIP,IAElB,QAACQ,EAA4B,CAE3BlB,MAAOA,EACPU,KAAMA,EACNT,SAAUA,EACVC,aAAcA,EACdC,OAAQA,EACRC,WAAYA,GANPM,SAanB,CAMO,SAASS,EAAqBC,GACnC,OAAIA,EACEC,EAAAA,GAAeD,GACV,WAELE,EAAAA,GAAWF,GACN,OAELG,EAAAA,GAAAA,SAA0BH,GACrB,aAEI,SAATA,EACK,UAEF,SAEF,QACT,CAEA,SAASF,EAA6B,GAOA,IAPA,MACpClB,EAAK,KACLU,EAAI,SACJT,EAAQ,aACRC,EAAY,OACZC,EAAM,WACNC,GACkC,EAClC,MAAM,MAACoB,EAAK,KAAEJ,GAAQpB,EAAMQ,eAAeE,IAAS,CAAC,EACrD,GAAc,OAAVc,EACF,OAAO,KAGT,MAAMC,EAAYN,EAAqBC,GACjCM,EAA4B,WAAdD,EAA0B,GAAED,KAASJ,IAASI,EAC5DG,EAAWF,EACbG,EAAAA,GAAiBH,GAAWI,WAC1BnB,EACA,CAAC,CAACA,GAAOgB,GACT,CAACzB,WAAUC,eAAckB,SAE3BM,EAEJ,SAASI,EAAsBC,GAC7B,MAAMC,EAAYC,EAAAA,GAAAA,aAAuBhC,GAEzC,OADA+B,EAAUD,MAAQA,EACV5B,GACN,KAAKR,EAAsBuC,YACzB,OAAOC,EAAAA,EAAAA,IAAiC,CACtCC,QAASlC,EAAamC,KACtBC,YAAatC,EAAMuC,MACnBC,UAAWxC,EAAMwC,UACjBT,MAAO,CAACA,WAEZ,KAAKpC,EAAsB8C,SAC3B,QACE,OAAOT,EAAUU,wBAAwBxC,EAAamC,KAAMjC,GAElE,CAIA,IAAIuC,EAAoBnB,EAQxB,MAPqB,iBAAVA,GAAsBJ,GAAQuB,IACnCrC,OAAOC,KAAKe,EAAAA,IAAYsB,SAASxB,GACnCuB,GAAqBrB,EAAAA,GAAWF,GACvBd,OAAOC,KAAKc,EAAAA,IAAgBuB,SAASxB,KAC9CuB,GAAqBtB,EAAAA,GAAeD,MAItC,QAACyB,EAAW,YACV,0BACE,wBAAMnC,KACN,QAACoC,EAAQ,WACP,QAACC,EAAK,UAAEpB,UAGZ,QAACqB,EAAyB,CACxBC,MAAO,CACL,CACEC,IAAK,gBACLC,OAAOpC,EAAAA,EAAAA,GAAE,+BACTqC,GAAItB,EAAuB,gBAAepB,KAAQiC,MAEpD,CACEO,IAAK,gBACLC,OAAOpC,EAAAA,EAAAA,GAAE,+BACTqC,GAAItB,EAAuB,iBAAgBpB,KAAQiC,MAErD,CACEO,IAAK,2BACLC,OAAOpC,EAAAA,EAAAA,GAAE,wCACTqC,GAAItB,EAAuB,gBAAepB,MAASiC,MAErD,CACEO,IAAK,wBACLC,OAAOpC,EAAAA,EAAAA,GAAE,qCACTqC,GAAItB,EAAuB,gBAAepB,MAASiC,OAGvDU,aAAc,CACZ,cAActC,EAAAA,EAAAA,GAAE,kBAChBuC,KAAM,KACNC,YAAY,EACZC,aAAa,EACbC,MAAM,QAAC,KAAY,CAACC,UAAU,OAAOJ,KAAK,QAE5CK,SAAS,iBAIjB,EAvKC,SAHWhE,GAAAA,EAAqB,0BAArBA,EAAqB,oBAGhC,CAHWA,IAAAA,EAAqB,KAiBTI,EAA6B,4CA6D5CmB,EAA4B,2CA8FrC,MAAMF,GAAe,OAAO,MAAK,mBAAZ,CAAa,iCAEb4C,EAAAA,EAAAA,GAAM,GAAE,KAGvB9C,GAAY,OAAO,MAAK,mBAAZ,CAAa,cAChB+C,GAAKA,EAAEC,MAAMC,gBAAc,mBACvBH,EAAAA,EAAAA,GAAM,GAAE,KAGrBf,GAAc,OAAOmB,EAAAA,GAAK,mBAAZ,CAAa,YACpBJ,EAAAA,EAAAA,GAAM,GAAE,KAAIA,EAAAA,EAAAA,GAAM,KAAI,mBAChBA,EAAAA,EAAAA,GAAM,GAAE,kBAIrBd,GAAW,OAAO,MAAK,mBAAZ,CAAa,0DAKxBC,GAAQ,OAAO,OAAM,mBAAb,CAAc,cACbc,GAAKA,EAAEC,MAAMG,oBAAkB,KAGxCjB,GAA4B,OAAOkB,EAAAA,EAAY,mBAAnB,CAAoB,0C","sources":["webpack:///./app/components/events/eventCustomPerformanceMetrics.tsx"],"sourcesContent":["import styled from '@emotion/styled';\nimport {Location} from 'history';\n\nimport {SectionHeading} from 'sentry/components/charts/styles';\nimport {DropdownMenu} from 'sentry/components/dropdownMenu';\nimport {Panel} from 'sentry/components/panels';\nimport {IconEllipsis} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport {Organization} from 'sentry/types';\nimport {Event} from 'sentry/types/event';\nimport EventView from 'sentry/utils/discover/eventView';\nimport {\n  DURATION_UNITS,\n  FIELD_FORMATTERS,\n  PERCENTAGE_UNITS,\n  SIZE_UNITS,\n} from 'sentry/utils/discover/fieldRenderers';\nimport {isCustomMeasurement} from 'sentry/views/dashboards/utils';\nimport {transactionSummaryRouteWithQuery} from 'sentry/views/performance/transactionSummary/utils';\n\nexport enum EventDetailPageSource {\n  PERFORMANCE = 'performance',\n  DISCOVER = 'discover',\n}\n\ntype Props = {\n  event: Event;\n  location: Location;\n  organization: Organization;\n  isHomepage?: boolean;\n  source?: EventDetailPageSource;\n};\n\nfunction isNotMarkMeasurement(field: string) {\n  return !field.startsWith('mark.');\n}\n\nexport default function EventCustomPerformanceMetrics({\n  event,\n  location,\n  organization,\n  source,\n  isHomepage,\n}: Props) {\n  const measurementNames = Object.keys(event.measurements ?? {})\n    .filter(name => isCustomMeasurement(`measurements.${name}`))\n    .filter(isNotMarkMeasurement)\n    .sort();\n\n  if (measurementNames.length === 0) {\n    return null;\n  }\n\n  return (\n    <Container>\n      <SectionHeading>{t('Custom Performance Metrics')}</SectionHeading>\n      <Measurements>\n        {measurementNames.map(name => {\n          return (\n            <EventCustomPerformanceMetric\n              key={name}\n              event={event}\n              name={name}\n              location={location}\n              organization={organization}\n              source={source}\n              isHomepage={isHomepage}\n            />\n          );\n        })}\n      </Measurements>\n    </Container>\n  );\n}\n\ntype EventCustomPerformanceMetricProps = Props & {\n  name: string;\n};\n\nexport function getFieldTypeFromUnit(unit) {\n  if (unit) {\n    if (DURATION_UNITS[unit]) {\n      return 'duration';\n    }\n    if (SIZE_UNITS[unit]) {\n      return 'size';\n    }\n    if (PERCENTAGE_UNITS.includes(unit)) {\n      return 'percentage';\n    }\n    if (unit === 'none') {\n      return 'integer';\n    }\n    return 'string';\n  }\n  return 'number';\n}\n\nfunction EventCustomPerformanceMetric({\n  event,\n  name,\n  location,\n  organization,\n  source,\n  isHomepage,\n}: EventCustomPerformanceMetricProps) {\n  const {value, unit} = event.measurements?.[name] ?? {};\n  if (value === null) {\n    return null;\n  }\n\n  const fieldType = getFieldTypeFromUnit(unit);\n  const renderValue = fieldType === 'string' ? `${value} ${unit}` : value;\n  const rendered = fieldType\n    ? FIELD_FORMATTERS[fieldType].renderFunc(\n        name,\n        {[name]: renderValue},\n        {location, organization, unit}\n      )\n    : renderValue;\n\n  function generateLinkWithQuery(query: string) {\n    const eventView = EventView.fromLocation(location);\n    eventView.query = query;\n    switch (source) {\n      case EventDetailPageSource.PERFORMANCE:\n        return transactionSummaryRouteWithQuery({\n          orgSlug: organization.slug,\n          transaction: event.title,\n          projectID: event.projectID,\n          query: {query},\n        });\n      case EventDetailPageSource.DISCOVER:\n      default:\n        return eventView.getResultsViewUrlTarget(organization.slug, isHomepage);\n    }\n  }\n\n  // Some custom perf metrics have units.\n  // These custom perf metrics need to be adjusted to the correct value.\n  let customMetricValue = value;\n  if (typeof value === 'number' && unit && customMetricValue) {\n    if (Object.keys(SIZE_UNITS).includes(unit)) {\n      customMetricValue *= SIZE_UNITS[unit];\n    } else if (Object.keys(DURATION_UNITS).includes(unit)) {\n      customMetricValue *= DURATION_UNITS[unit];\n    }\n  }\n  return (\n    <StyledPanel>\n      <div>\n        <div>{name}</div>\n        <ValueRow>\n          <Value>{rendered}</Value>\n        </ValueRow>\n      </div>\n      <StyledDropdownMenuControl\n        items={[\n          {\n            key: 'includeEvents',\n            label: t('Show events with this value'),\n            to: generateLinkWithQuery(`measurements.${name}:${customMetricValue}`),\n          },\n          {\n            key: 'excludeEvents',\n            label: t('Hide events with this value'),\n            to: generateLinkWithQuery(`!measurements.${name}:${customMetricValue}`),\n          },\n          {\n            key: 'includeGreaterThanEvents',\n            label: t('Show events with values greater than'),\n            to: generateLinkWithQuery(`measurements.${name}:>${customMetricValue}`),\n          },\n          {\n            key: 'includeLessThanEvents',\n            label: t('Show events with values less than'),\n            to: generateLinkWithQuery(`measurements.${name}:<${customMetricValue}`),\n          },\n        ]}\n        triggerProps={{\n          'aria-label': t('Widget actions'),\n          size: 'xs',\n          borderless: true,\n          showChevron: false,\n          icon: <IconEllipsis direction=\"down\" size=\"sm\" />,\n        }}\n        position=\"bottom-end\"\n      />\n    </StyledPanel>\n  );\n}\n\nconst Measurements = styled('div')`\n  display: grid;\n  grid-column-gap: ${space(1)};\n`;\n\nconst Container = styled('div')`\n  font-size: ${p => p.theme.fontSizeMedium};\n  margin-bottom: ${space(4)};\n`;\n\nconst StyledPanel = styled(Panel)`\n  padding: ${space(1)} ${space(1.5)};\n  margin-bottom: ${space(1)};\n  display: flex;\n`;\n\nconst ValueRow = styled('div')`\n  display: flex;\n  align-items: center;\n`;\n\nconst Value = styled('span')`\n  font-size: ${p => p.theme.fontSizeExtraLarge};\n`;\n\nconst StyledDropdownMenuControl = styled(DropdownMenu)`\n  margin-left: auto;\n`;\n"],"names":["EventDetailPageSource","isNotMarkMeasurement","field","startsWith","EventCustomPerformanceMetrics","event","location","organization","source","isHomepage","measurementNames","Object","keys","measurements","filter","name","isCustomMeasurement","sort","length","Container","t","Measurements","map","EventCustomPerformanceMetric","getFieldTypeFromUnit","unit","DURATION_UNITS","SIZE_UNITS","PERCENTAGE_UNITS","value","fieldType","renderValue","rendered","FIELD_FORMATTERS","renderFunc","generateLinkWithQuery","query","eventView","EventView","PERFORMANCE","transactionSummaryRouteWithQuery","orgSlug","slug","transaction","title","projectID","DISCOVER","getResultsViewUrlTarget","customMetricValue","includes","StyledPanel","ValueRow","Value","StyledDropdownMenuControl","items","key","label","to","triggerProps","size","borderless","showChevron","icon","direction","position","space","p","theme","fontSizeMedium","Panel","fontSizeExtraLarge","DropdownMenu"],"sourceRoot":""}