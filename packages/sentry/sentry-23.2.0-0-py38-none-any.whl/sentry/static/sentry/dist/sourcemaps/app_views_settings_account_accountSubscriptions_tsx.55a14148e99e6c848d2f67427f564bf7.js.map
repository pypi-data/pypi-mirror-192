{"version":3,"file":"chunks/app_views_settings_account_accountSubscriptions_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/account/accountSubscriptions.tsx","webpack:///../node_modules/lodash/findIndex.js"],"sourcesContent":["import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {Fragment} from 'react';\nimport styled from '@emotion/styled';\nimport findIndex from 'lodash/findIndex';\nimport groupBy from 'lodash/groupBy';\nimport moment from 'moment';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport DateTime from 'sentry/components/dateTime';\nimport EmptyMessage from 'sentry/components/emptyMessage';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'sentry/components/panels';\nimport Switch from 'sentry/components/switchButton';\nimport {IconToggle} from 'sentry/icons';\nimport {t, tct} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport AsyncView from 'sentry/views/asyncView';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\n\nconst ENDPOINT = '/users/me/subscriptions/';\n\ntype Subscription = {\n  email: string;\n  listDescription: string;\n  listId: number;\n  listName: string;\n  subscribed: boolean;\n  subscribedDate: string | null;\n  unsubscribedDate: string | null;\n};\n\ntype State = AsyncView['state'] & {\n  subscriptions: Subscription[];\n};\n\nclass AccountSubscriptions extends AsyncView<AsyncView['props'], State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['subscriptions', ENDPOINT]];\n  }\n\n  getTitle() {\n    return 'Subscriptions';\n  }\n\n  handleToggle = (subscription: Subscription, listId: number, _e: React.MouseEvent) => {\n    const subscribed = !subscription.subscribed;\n    const oldSubscriptions = this.state.subscriptions;\n\n    this.setState(state => {\n      const newSubscriptions = state.subscriptions.slice();\n      const index = findIndex(newSubscriptions, {listId});\n      newSubscriptions[index] = {\n        ...subscription,\n        subscribed,\n        subscribedDate: new Date().toString(),\n      };\n      return {\n        ...state,\n        subscriptions: newSubscriptions,\n      };\n    });\n\n    this.api.request(ENDPOINT, {\n      method: 'PUT',\n      data: {\n        listId: subscription.listId,\n        subscribed,\n      },\n      success: () => {\n        addSuccessMessage(\n          `${subscribed ? 'Subscribed' : 'Unsubscribed'} to ${subscription.listName}`\n        );\n      },\n      error: () => {\n        addErrorMessage(\n          `Unable to ${subscribed ? '' : 'un'}subscribe to ${subscription.listName}`\n        );\n        this.setState({subscriptions: oldSubscriptions});\n      },\n    });\n  };\n\n  renderBody() {\n    const subGroups = Object.entries(groupBy(this.state.subscriptions, sub => sub.email));\n\n    return (\n      <div>\n        <SettingsPageHeader title=\"Subscriptions\" />\n        <TextBlock>\n          {t(`Sentry is committed to respecting your inbox. Our goal is to\n              provide useful content and resources that make fixing errors less\n              painful. Enjoyable even.`)}\n        </TextBlock>\n\n        <TextBlock>\n          {t(`As part of our compliance with the EU’s General Data Protection\n              Regulation (GDPR), starting on 25 May 2018, we’ll only email you\n              according to the marketing categories to which you’ve explicitly\n              opted-in.`)}\n        </TextBlock>\n\n        <Panel>\n          {this.state.subscriptions.length ? (\n            <div>\n              <PanelHeader>{t('Subscription')}</PanelHeader>\n              <PanelBody>\n                {subGroups.map(([email, subscriptions]) => (\n                  <Fragment key={email}>\n                    {subGroups.length > 1 && (\n                      <Heading>\n                        <IconToggle /> {t('Subscriptions for %s', email)}\n                      </Heading>\n                    )}\n\n                    {subscriptions.map(subscription => (\n                      <PanelItem center key={subscription.listId}>\n                        <SubscriptionDetails>\n                          <SubscriptionName>{subscription.listName}</SubscriptionName>\n                          {subscription.listDescription && (\n                            <Description>{subscription.listDescription}</Description>\n                          )}\n                          {subscription.subscribed ? (\n                            <SubscribedDescription>\n                              <div>\n                                {tct('[email] on [date]', {\n                                  email: subscription.email,\n                                  date: (\n                                    <DateTime\n                                      date={moment(subscription.subscribedDate!)}\n                                    />\n                                  ),\n                                })}\n                              </div>\n                            </SubscribedDescription>\n                          ) : (\n                            <SubscribedDescription>\n                              {t('Not currently subscribed')}\n                            </SubscribedDescription>\n                          )}\n                        </SubscriptionDetails>\n                        <div>\n                          <Switch\n                            isActive={subscription.subscribed}\n                            size=\"lg\"\n                            toggle={this.handleToggle.bind(\n                              this,\n                              subscription,\n                              subscription.listId\n                            )}\n                          />\n                        </div>\n                      </PanelItem>\n                    ))}\n                  </Fragment>\n                ))}\n              </PanelBody>\n            </div>\n          ) : (\n            <EmptyMessage>{t(\"There's no subscription backend present.\")}</EmptyMessage>\n          )}\n        </Panel>\n        <TextBlock>\n          {t(`We’re applying GDPR consent and privacy policies to all Sentry\n              contacts, regardless of location. You’ll be able to manage your\n              subscriptions here and from an Unsubscribe link in the footer of\n              all marketing emails.`)}\n        </TextBlock>\n\n        <TextBlock>\n          {tct(\n            'Please contact [email:learn@sentry.io] with any questions or suggestions.',\n            {email: <a href=\"mailto:learn@sentry.io\" />}\n          )}\n        </TextBlock>\n      </div>\n    );\n  }\n}\n\nconst Heading = styled(PanelItem)`\n  display: grid;\n  grid-template-columns: max-content 1fr;\n  gap: ${space(1)};\n  align-items: center;\n  font-size: ${p => p.theme.fontSizeMedium};\n  padding: ${space(1.5)} ${space(2)};\n  background: ${p => p.theme.backgroundSecondary};\n  color: ${p => p.theme.subText};\n`;\n\nconst SubscriptionDetails = styled('div')`\n  width: 50%;\n  padding-right: ${space(2)};\n`;\n\nconst SubscriptionName = styled('div')`\n  font-size: ${p => p.theme.fontSizeMedium};\n`;\nconst Description = styled('div')`\n  font-size: ${p => p.theme.fontSizeSmall};\n  color: ${p => p.theme.subText};\n  margin-top: ${space(0.5)};\n`;\n\nconst SubscribedDescription = styled(Description)`\n  color: ${p => p.theme.subText};\n`;\n\nexport default AccountSubscriptions;\n","var baseFindIndex = require('./_baseFindIndex'),\n    baseIteratee = require('./_baseIteratee'),\n    toInteger = require('./toInteger');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * This method is like `_.find` except that it returns the index of the first\n * element `predicate` returns truthy for instead of the element itself.\n *\n * @static\n * @memberOf _\n * @since 1.1.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @param {number} [fromIndex=0] The index to search from.\n * @returns {number} Returns the index of the found element, else `-1`.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'active': false },\n *   { 'user': 'fred',    'active': false },\n *   { 'user': 'pebbles', 'active': true }\n * ];\n *\n * _.findIndex(users, function(o) { return o.user == 'barney'; });\n * // => 0\n *\n * // The `_.matches` iteratee shorthand.\n * _.findIndex(users, { 'user': 'fred', 'active': false });\n * // => 1\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.findIndex(users, ['active', false]);\n * // => 0\n *\n * // The `_.property` iteratee shorthand.\n * _.findIndex(users, 'active');\n * // => 2\n */\nfunction findIndex(array, predicate, fromIndex) {\n  var length = array == null ? 0 : array.length;\n  if (!length) {\n    return -1;\n  }\n  var index = fromIndex == null ? 0 : toInteger(fromIndex);\n  if (index < 0) {\n    index = nativeMax(length + index, 0);\n  }\n  return baseFindIndex(array, baseIteratee(predicate, 3), index);\n}\n\nmodule.exports = findIndex;\n"],"names":["AsyncView","AsyncComponent","getTitle","render","title","this","renderComponent","ENDPOINT","AccountSubscriptions","subscription","listId","_e","subscribed","oldSubscriptions","state","subscriptions","setState","newSubscriptions","slice","findIndex","subscribedDate","Date","toString","api","request","method","data","success","addSuccessMessage","listName","error","addErrorMessage","getEndpoints","renderBody","subGroups","Object","entries","groupBy","sub","email","t","length","map","Fragment","Heading","center","SubscriptionDetails","SubscriptionName","listDescription","Description","SubscribedDescription","tct","date","moment","isActive","size","toggle","handleToggle","bind","href","PanelItem","space","p","theme","fontSizeMedium","backgroundSecondary","subText","fontSizeSmall","baseFindIndex","baseIteratee","toInteger","nativeMax","Math","max","module","exports","array","predicate","fromIndex","index"],"sourceRoot":""}