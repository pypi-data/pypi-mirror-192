#!python
# This file is placed in the Public Domain.


"operator bot daemon"


import traceback


from operbot.handler import Handler, scan
from operbot.modules import cmd, irc, log, rss, tdo
from operbot.storage import Storage
from operbot.utility import privileges, wait


Storage.workdir = "/var/lib/operbot/"


scan(cmd)
scan(log)
scan(rss)
scan(tdo)


def waiter():
    got = []
    for ex in Handler.errors:
        traceback.print_exception(type(ex), ex, ex.__traceback__)
        got.append(ex)
    for exc in got:
        Handler.errors.remove(exc)


def main():
    #privileges("operbot")
    irc.init()
    rss.init()
    wait(waiter)


main()
